<meta charset="UTF-8">
<html>
	<div id="schedule">
	</div>

	<div id="ids"></div>

<style type="text/css">
	table {
		border: 1px solid black;
		float: left;
	}

	td {
		background-color: #DDDDDD;
		width: 150px;
		padding: 5px;
	}

	#ids {
		width: 200px;
		float: right;
	}

	#ids:before{
		content: "Sessions";
		font-weight: bold;
	}

	.day {
		background-color: #666;
		color: #FFF;
	}

	.session {
		padding: 5px;
		border: #000 solid 1px;
		margin: 2px;
	}

</style>

<script src="jquery-2.0.3.min.js"></script>
<script type="text/javascript">
	var sessions = [];


	function retrieveSessions() {
		var address = "accepted_sessions.json";
		$.getJSON(address)
		.done(function(accepted_sessions) {
			sessions = accepted_sessions;
			$.each(accepted_sessions, function(i, session) {
				$("<div class='session'>" + session.id + "</div>").appendTo("#ids");
			});
		})
		.fail(function() {
			console.log("error retrieving accepted_sessions");
		});
	}

	function tweakDates() {
		Date.prototype.addHalfHour = function() {
			this.setTime(this.getTime() + 30 * 60 * 1000);
		};
		Date.prototype.dateToJSON = function() {
			return this.toJSON().substring(0, 11);
		};
		Date.prototype.timeToJSON = function() {
			return this.toLocaleTimeString().substring(0,5);
		};
	}

	function buildTableHead(date) {
		var thead = $("<thead>");
		var tr = $("<tr>");
		var firstColumn = $("<th>").attr("class", "day").html(date.toLocaleDateString()).appendTo(tr);
		for (var i = 1; i <= 6; i++) {
			var td = $("<th>").attr("data-room", i).html("Sala "+ i).appendTo(tr);
		}
		tr.appendTo(thead);
		return thead;
	}

	function buildTableLine(date) {
		var tr = $("<tr>").attr("date-time", date.timeToJSON());
		var th = $("<th>").html(date.timeToJSON()).appendTo(tr);

		for (var i = 1; i <= 6; i++) {
			var td = $("<td>").attr("data-room", i).appendTo(tr);
		}
		return tr;
	}

	function buildTable() {
		var date = new Date(2014, 11, 5, 9, 0);
		var table = $("<table>").attr("data-date", date.dateToJSON());

		buildTableHead(date).appendTo(table);
		while(date.getHours() < 19) {
			buildTableLine(date).appendTo(table);
			date.addHalfHour();
		}
		table.appendTo("#schedule");
	}

	retrieveSessions();	
	tweakDates();
	buildTable();
</script>

</html>